(()=>{"use strict";var e={formSelector:".popup__form",inputSelector:".popup__form-item",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__form-item_type_error",errorClass:"popup__form-item-error_type_active"};function t(e,t,r){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(r.inputErrorClass),n.classList.remove(r.errorClass),n.textContent=""}function r(e,r){var n=e.querySelector(r.formSelector);Array.from(n.querySelectorAll(r.inputSelector)).forEach((function(e){return t(n,e,r)}))}function n(e,t,r){!function(e){return e.some((function(e){return!e.validity.valid}))}(t)?(e.classList.remove(r.inactiveButtonClass),e.removeAttribute("disabled")):(e.classList.add(r.inactiveButtonClass),e.setAttribute("disabled",""))}var o=document.querySelector(".cards-grid__template").content;function c(e,t){e.textContent=t.length}function a(e,t){var r=o.querySelector(".cards-grid__item").cloneNode(!0),n=r.querySelector(".cards-grid__image"),a=r.querySelector(".cards-grid__delete-card"),i=r.querySelector(".cards-grid__like"),u=r.querySelector(".cards-grid__like-counter");return r.querySelector(".cards-grid__title").textContent=e.name,n.setAttribute("src",e.link),n.setAttribute("alt",e.name),e.likes.find((function(e){return e._id===t}))&&i.classList.add("cards-grid__like_active"),c(u,e.likes),e.owner._id===t&&(a.style.display="block"),n.addEventListener("click",(function(){var t,r;t=e.link,r=e.name,x.setAttribute("src",t),x.setAttribute("alt",r),U.textContent=r,w(k)})),i.addEventListener("click",(function(t){!function(e,t,r,n){e.target.classList.toggle("cards-grid__like_active"),e.target.classList.contains("cards-grid__like_active")?v(t,r,n):h(t,n)}(t,e._id,e.likes,u)})),a.addEventListener("click",(function(t){y(e._id),function(e){e.target.closest(".cards-grid__item").remove()}(t)})),r}var i,u={baseURL:"https://mesto.nomoreparties.co/v1/plus-cohort-9",headers:{authorization:"74c00ac7-1a8f-4bac-9e3c-4553885ebfeb","Content-Type":"application/json"}},s=document.querySelector(".profile__name"),l=document.querySelector(".profile__bio"),d=document.querySelector(".profile__avatar"),p=document.querySelector(".cards-grid__list");function _(e){return e.ok?e.json():Promise.reject(e.status)}function f(e){console.log("Ошибка: ".concat(e))}function m(e){s.textContent=e.name,l.textContent=e.about,d.src=e.avatar}var y=function(e){return fetch("".concat(u.baseURL,"/cards/").concat(e),{method:"DELETE",headers:u.headers}).then(_).catch(f)},v=function(e,t,r){return fetch("".concat(u.baseURL,"/cards/likes/").concat(e),{method:"PUT",headers:u.headers,body:JSON.stringify({likes:t})}).then(_).then((function(e){c(r,e.likes)})).catch(f)},h=function(e,t){return fetch("".concat(u.baseURL,"/cards/likes/").concat(e),{method:"DELETE",headers:u.headers}).then(_).then((function(e){c(t,e.likes)})).catch(f)};function S(e,t){e?(t.textContent="Сохранение...",t.disabled=!0):(t.classList.contains("popup__button_create")?t.textContent="Создать":t.textContent="Сохранить",t.disabled=!1)}var b=document.querySelectorAll(".popup"),q=document.querySelector(".popup_type_edit"),L=document.querySelector(".popup_type_add"),g=document.querySelector(".popup_type_avatar-edit"),k=document.querySelector(".popup_type_image"),E=q.querySelector(".popup__button"),C=L.querySelector(".popup__button"),A=g.querySelector(".popup__button"),x=k.querySelector(".popup__image"),U=k.querySelector(".popup__image-caption"),R=document.querySelector(".profile__name"),T=document.querySelector(".profile__bio"),B=q.querySelector("#name"),D=q.querySelector("#bio"),N=g.querySelector("#avatar-link"),O=L.querySelector("#place"),P=L.querySelector("#link");function J(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",j)}function j(e){"Escape"===e.key&&J(document.querySelector(".popup_opened"))}function w(e){e.classList.add("popup_opened"),document.addEventListener("keydown",j)}function H(t){n(t.querySelector(e.submitButtonSelector),Array.from(t.querySelectorAll(e.inputSelector)),e)}function z(e){e.reset(),H(e)}var M=document.querySelector(".profile__edit-button"),F=document.querySelector(".profile__add-button"),G=document.querySelector(".profile__avatar"),I=q.querySelector(".popup__form"),K=L.querySelector(".popup__form"),Q=g.querySelector(".popup__form");b.forEach((function(e){e.addEventListener("click",(function(t){(t.target.classList.contains("popup_opened")||t.target.classList.contains("popup__toggle"))&&J(e)}))})),M.addEventListener("click",(function(){var t;t=q,B.value=R.textContent,D.value=T.textContent,H(t),r(q,e),w(q)})),I.addEventListener("submit",(function(e){var t,r;e.preventDefault(),S(!0,E),t=B.value,r=D.value,fetch("".concat(u.baseURL,"/users/me"),{method:"PATCH",headers:u.headers,body:JSON.stringify({name:t,about:r})}).then(_).then((function(e){m(e)})).catch(f),J(q),S(!1,E)})),F.addEventListener("click",(function(){z(K),r(L,e),w(L)})),L.addEventListener("submit",(function(e){var t,r;e.preventDefault(),S(!0,C),t=O.value,r=P.value,fetch("".concat(u.baseURL,"/cards"),{method:"POST",headers:u.headers,body:JSON.stringify({name:t,link:r})}).then(_).then((function(e){p.prepend(a(e,i._id))})).catch(f),J(L),S(!1,C)})),G.addEventListener("click",(function(){z(Q),r(g,e),w(g)})),Q.addEventListener("submit",(function(e){var t;e.preventDefault(),S(!0,A),t=N.value,fetch("".concat(u.baseURL,"/users/me/avatar"),{method:"PATCH",headers:u.headers,body:JSON.stringify({avatar:t})}).then(_).then((function(e){m(e)})).catch(f),J(g),S(!1,A)})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(r){r.addEventListener("submit",(function(e){e.preventDefault()})),function(e,r){var o=Array.from(e.querySelectorAll(r.inputSelector)),c=e.querySelector(r.submitButtonSelector);n(c,o,r),o.forEach((function(a){a.addEventListener("input",(function(){!function(e,r,n){r.validity.valid?t(e,r,n):function(e,t,r,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add(n.inputErrorClass),o.textContent=r,o.classList.add(n.errorClass)}(e,r,r.validationMessage,n)}(e,a,r),n(c,o,r)}))}))}(r,e)}))}(e),fetch("".concat(u.baseURL,"/users/me"),{headers:u.headers}).then(_).then((function(e){m(e),i=e})).catch(f),fetch("".concat(u.baseURL,"/cards"),{headers:u.headers}).then(_).then((function(e){e.forEach((function(e){p.append(a(e,i._id))}))})).catch(f)})();